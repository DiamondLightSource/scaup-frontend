image: node:19.4.0

stages:
  - test
  - build
  - sync

build-job:
  stage: test
  tags:
    - argus
  script:
    - yarn install
    - yarn build
  rules:
    - if: $CI_COMMIT_MESSAGE !~ /\[WIP\].*/

unit-test-job:
  stage: test
  tags:
    - argus
  before_script:
    - yarn install
  script:
    - yarn run test
  rules:
    - if: $CI_COMMIT_MESSAGE !~ /\[WIP\].*/
  coverage: /All files[^|]*\|[^|]*\s+([\d\.]+)/
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml
